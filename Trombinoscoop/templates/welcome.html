{% extends "base.html" %}

{% block title %}Accueil{% endblock %}

{% block bodyId %}welcomePage{% endblock %}

{% block headerContent %}
<p id="name">{{ logged_user.first_name }} {{ logged_user.last_name }}</p>
<p id="function">    
    {% if logged_user.person_type == 'student' %}
        Etudiant en 
        {% if logged_user.year == 1 %}
            {{ logged_user.year }}ère année
        {% else %}
            {{ logged_user.year }}ème année
        {% endif %}
        {{ logged_user.cursus.title }}
    {% else %}
        {{ logged_user.job.title|capfirst }}
        dans la faculté {{ logged_user.faculty }}
    {% endif %}
</p>
<p id="profileLinks">
    <a href="{% url 'show_profile' logged_user.id %}" class="buttonLink">Voir le profil</a>
    <a href="{% url 'modify_profile' %}" class="buttonLink">Modifier le profil</a>
</p>
<p><a href="{% url 'login' %}" id="backToLogin">Se déconnecter</a></p>
{% endblock %}
{% block content %}
<section id="messageList">
    <form method="GET" action="" class="inlineForm">
        <label for="newMessageInput">Publier un message :</label>
        <input type="text" name="newMessage" id="newMessageInput"/>
        <input type="submit" value="Publier"/>
    </form>
    <ul>        
    {% for message in friendMessages %}
    <li>
        <p>
            <a href="{% url 'show_profile' message.author.id %}">{{ message.author.first_name }}
            {{ message.author.last_name }}
            </a> dit:
        </p>
        <p>{{ message.content }}</p>
    </li>
    {% endfor %}            
    </ul>
</section>
<section id="friendList">
    <p class="title">Mes amis</p>
    <form method="GET" action="" class="inlineForm">
        <input type="email" name="newFriendEmail" id="newFriendInput" placeholder="Email"/>
        <input type="submit" value="Ajouter"/>
    </form>
    <p><a href="{% url 'add_friend' %}" class="buttonLink">Ajouter</a></p>
    <ul>        
    {% for friend in logged_user.friends.all %}
        <li><a href="{% url 'show_profile' friend.id %}">{{ friend.first_name }} {{ friend.last_name }}</a></li>
    {% endfor %}            
    </ul>
</section>
{% block javascript %} {# comment here #}
<script type="text/javascript">
    async function addFriend(event){
        event.preventDefault();
        let email = $('#newFriendInput').val();
        $.ajax({
            url: '{% url 'ajax_add_friend' %}', 
            data: {'csrfmiddlewaretoken': '{{ csrf_token }}', 'newFriendEmail': email},
            type: 'GET',
            success: function(data, textStatus, XMLHttpRequest){
                if(data != ''){
                    alert(data);
                    //$('#friendList form').parent().prev('.errorlist').remove();
                    //$('#friendList form').parent().before(data);
                }
            }
        })
        //return false;
    }
    
    $(document).ready(function(){$('#friendList form').submit(addFriend)});
</script>
{% endblock javascript %}
{% endblock %}

{% comment %} {% block Content %}
<h1>Page d'accueil</h1>
<p>
    {{ logged_user.first_name }} {{ logged_user.last_name }}, bienvenue sur Trombinoscoop !
</p>
<p>Nous sommes le {{ current_date_time }}</p>
{% endblock %} {% endcomment %}